<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MAD - MCP Artifact Digger</title>
    <link rel="stylesheet" href="/static/css/style.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
</head>
<body>
    <div class="app">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <div class="logo">
                    <span>MAD</span>
                </div>
                <span class="version">v0.1.0</span>
            </div>

            <nav class="sidebar-nav">
                <a href="#" class="nav-item active" data-section="upload">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                        <polyline points="17 8 12 3 7 8"/>
                        <line x1="12" y1="3" x2="12" y2="15"/>
                    </svg>
                    <span>Upload</span>
                </a>
                <a href="#" class="nav-item" data-section="analysis">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M21 21H4.6C4.03995 21 3.75992 21 3.54601 20.891C3.35785 20.7951 3.20487 20.6422 3.10899 20.454C3 20.2401 3 19.9601 3 19.4V3"/>
                        <path d="M7 14l4-4 4 4 6-6"/>
                    </svg>
                    <span>Analysis</span>
                </a>
                <a href="#" class="nav-item" data-section="timeline">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="10"/>
                        <polyline points="12 6 12 12 16 14"/>
                    </svg>
                    <span>Timeline</span>
                </a>
                <!-- Comparison tab hidden - not yet complete
                <a href="#" class="nav-item" data-section="comparison">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="3" y="3" width="7" height="7"/>
                        <rect x="14" y="3" width="7" height="7"/>
                        <rect x="14" y="14" width="7" height="7"/>
                        <rect x="3" y="14" width="7" height="7"/>
                    </svg>
                    <span>Comparison</span>
                </a>
                -->
            </nav>

            <div class="sidebar-footer">
                <div class="status-indicator">
                    <span class="status-dot"></span>
                    <span>Ready</span>
                </div>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Header -->
            <header class="header">
                <div class="header-title">
                    <h1>Artifact Analysis</h1>
                    <p>Model Context Protocol forensic investigation</p>
                </div>
                <div class="header-actions">
                    <button class="btn btn-ghost" id="clearBtn" style="display:none;">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M3 6h18M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
                        </svg>
                        Clear
                    </button>
                </div>
            </header>

            <!-- Stats Bar (shown after analysis) -->
            <div class="stats-bar" id="statsBar" style="display:none;">
                <div class="stat-card">
                    <div class="stat-icon servers">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="2" y="3" width="20" height="6" rx="1"/>
                            <rect x="2" y="15" width="20" height="6" rx="1"/>
                            <circle cx="6" cy="6" r="1"/><circle cx="6" cy="18" r="1"/>
                        </svg>
                    </div>
                    <div class="stat-info">
                        <span class="stat-value" id="statServers">0</span>
                        <span class="stat-label">Servers</span>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon tools">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z"/>
                        </svg>
                    </div>
                    <div class="stat-info">
                        <span class="stat-value" id="statTools">0</span>
                        <span class="stat-label">Tools</span>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon events">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M12 8v4l3 3"/>
                            <circle cx="12" cy="12" r="10"/>
                        </svg>
                    </div>
                    <div class="stat-info">
                        <span class="stat-value" id="statEvents">0</span>
                        <span class="stat-label">Events</span>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon sources">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                            <polyline points="14 2 14 8 20 8"/>
                        </svg>
                    </div>
                    <div class="stat-info">
                        <span class="stat-value" id="statSources">0</span>
                        <span class="stat-label">Sources</span>
                    </div>
                </div>
            </div>

            <!-- Content Sections -->
            <div class="content">
                <!-- Upload Section -->
                <section class="section active" id="uploadSection">
                    <div class="upload-container">
                        <div class="upload-area" id="uploadArea">
                            <div class="upload-icon">
                                <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                                    <polyline points="17 8 12 3 7 8"/>
                                    <line x1="12" y1="3" x2="12" y2="15"/>
                                </svg>
                            </div>
                            <h3>Drop artifacts here</h3>
                            <p>or click to browse files</p>
                            <div class="upload-formats">
                                <span class="format-tag">.vscdb</span>
                                <span class="format-tag">mcp.json</span>
                                <span class="format-tag">.log</span>
                                <span class="format-tag">.jsonl</span>
                                <span class="format-tag">.pcap</span>
                                <span class="format-tag">.har</span>
                            </div>
                            <input type="file" id="fileInput" multiple accept=".json,.log,.jsonl,.pcap,.har,.pcapng,.vscdb,.db,.sqlite">
                        </div>

                        <div class="file-queue" id="fileQueue" style="display:none;">
                            <div class="queue-header">
                                <h4>Selected Files</h4>
                                <span class="file-count" id="fileCount">0 files</span>
                            </div>
                            <div class="file-list" id="fileList"></div>
                            <div class="queue-actions">
                                <button class="btn btn-secondary" id="clearFilesBtn">Clear All</button>
                                <button class="btn btn-primary" id="analyzeBtn">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <circle cx="11" cy="11" r="8"/>
                                        <path d="M21 21l-4.35-4.35"/>
                                    </svg>
                                    Analyze
                                </button>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Analysis Section -->
                <section class="section" id="analysisSection">
                    <div class="panel-grid">
                        <div class="panel">
                            <div class="panel-header">
                                <h3>MCP Servers</h3>
                                <span class="badge" id="serverCount">0</span>
                            </div>
                            <div class="panel-content" id="serverList"></div>
                        </div>
                        <div class="panel">
                            <div class="panel-header">
                                <h3>Registered Tools</h3>
                                <span class="badge" id="toolCount">0</span>
                            </div>
                            <div class="panel-content" id="toolList"></div>
                        </div>
                    </div>
                    <div class="panel full-width" id="serverUsagePanel" style="display:none;">
                        <div class="panel-header">
                            <h3>MCP Server Usage (from Conversations)</h3>
                        </div>
                        <div class="panel-content" id="serverUsageList"></div>
                    </div>

                    <!-- Forensic Metadata Panel -->
                    <div class="panel full-width" id="forensicMetadataPanel" style="display:none;">
                        <div class="panel-header">
                            <h3>Forensic Metadata (Remote MCP)</h3>
                            <span class="badge warning" id="forensicServerCount">0</span>
                        </div>
                        <div class="panel-content" id="forensicMetadataList"></div>
                    </div>

                    <div class="panel full-width">
                        <div class="panel-header">
                            <h3>Raw Analysis Data</h3>
                            <div class="panel-actions">
                                <button class="btn btn-sm btn-ghost" id="copyJsonBtn">
                                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <rect x="9" y="9" width="13" height="13" rx="2" ry="2"/>
                                        <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/>
                                    </svg>
                                    Copy
                                </button>
                                <button class="btn btn-sm btn-ghost" id="downloadJsonBtn">
                                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                                        <polyline points="7 10 12 15 17 10"/>
                                        <line x1="12" y1="15" x2="12" y2="3"/>
                                    </svg>
                                    Export
                                </button>
                            </div>
                        </div>
                        <pre class="json-viewer" id="jsonViewer"></pre>
                    </div>
                </section>

                <!-- Timeline Section -->
                <section class="section" id="timelineSection">
                    <div class="panel full-width">
                        <div class="panel-header">
                            <h3>Event Timeline</h3>
                            <div class="filter-controls">
                                <select id="serverFilter" class="filter-select">
                                    <option value="">All Servers</option>
                                </select>
                                <select id="eventTypeFilter" class="filter-select">
                                    <option value="">All Types</option>
                                    <option value="user_query">User Queries</option>
                                    <option value="ai_response">AI Responses</option>
                                    <option value="tool_call">Tool Calls</option>
                                    <option value="tool_result">Results</option>
                                    <option value="file_access">File Access</option>
                                    <option value="connection_init">Connections</option>
                                </select>
                            </div>
                        </div>
                        <div class="timeline-container" id="timelineView">
                            <div class="empty-state">
                                <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                    <circle cx="12" cy="12" r="10"/>
                                    <polyline points="12 6 12 12 16 14"/>
                                </svg>
                                <p>No events to display</p>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Comparison Section -->
                <section class="section" id="comparisonSection">
                    <div class="comparison-grid">
                        <div class="panel">
                            <div class="panel-header">
                                <h3>Artifact Availability</h3>
                            </div>
                            <div class="table-container">
                                <table class="data-table" id="artifactMatrix">
                                    <thead>
                                        <tr>
                                            <th>Artifact Type</th>
                                            <th>Local STDIO</th>
                                            <th>Custom Remote</th>
                                            <th>Official Remote</th>
                                        </tr>
                                    </thead>
                                    <tbody></tbody>
                                </table>
                            </div>
                        </div>
                        <div class="panel">
                            <div class="panel-header">
                                <h3>Forensic Capabilities</h3>
                            </div>
                            <div class="table-container">
                                <table class="data-table" id="capabilityMatrix">
                                    <thead>
                                        <tr>
                                            <th>Capability</th>
                                            <th>Local STDIO</th>
                                            <th>Custom Remote</th>
                                            <th>Official Remote</th>
                                        </tr>
                                    </thead>
                                    <tbody></tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                    <div class="insights-grid">
                        <div class="panel insights">
                            <div class="panel-header">
                                <h3>Key Findings</h3>
                            </div>
                            <ul class="insight-list" id="findingsList"></ul>
                        </div>
                        <div class="panel insights">
                            <div class="panel-header">
                                <h3>Recommendations</h3>
                            </div>
                            <ul class="insight-list recommendations" id="recommendationsList"></ul>
                        </div>
                    </div>
                </section>
            </div>

            <!-- Loading Overlay -->
            <div class="loading-overlay" id="loading" style="display:none;">
                <div class="loading-spinner">
                    <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M12 2v4m0 12v4m10-10h-4M6 12H2m15.07-5.07l-2.83 2.83M9.76 14.24l-2.83 2.83m11.31 0l-2.83-2.83M9.76 9.76L6.93 6.93"/>
                    </svg>
                </div>
                <p>Analyzing artifacts...</p>
            </div>

            <!-- Error Toast -->
            <div class="toast error" id="errorToast" style="display:none;">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="10"/>
                    <line x1="15" y1="9" x2="9" y2="15"/>
                    <line x1="9" y1="9" x2="15" y2="15"/>
                </svg>
                <span id="errorMessage"></span>
                <button class="toast-close" id="closeError">&times;</button>
            </div>
        </main>
    </div>

    <script src="/static/js/app.js"></script>
    <script src="/static/js/timeline.js"></script>
    <script src="/static/js/comparison.js"></script>
</body>
</html>
